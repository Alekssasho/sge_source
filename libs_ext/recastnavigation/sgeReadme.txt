Recast and Detour taken from version 1.5.1